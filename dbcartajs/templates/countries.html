{% extends 'base.html' %}
{% load i18n %}
{% block title %}dbCartajs - HTML5 Canvas map - World's Countries Demo{% endblock %}
{% block script %}
<script type="text/javascript" src="/media/js/proj4js-combined.js"></script>
<script type="text/javascript" src="/media/js/dbcarta.js"></script>
<script type="text/javascript" src="/media/js/demodata/continents.js"></script>
<script type="text/javascript" src="/media/js/demodata/countries.js"></script>
<script type="text/javascript">
  function draw() {
    var centerof, cntrylist = document.getElementById('cntrylist');
    for (var i=0; i<cntrylist.options.length; i++) {
      var opt = cntrylist.options[i];
      if (opt.selected) {
        var m = opt.text.split(".");
        var abbr = m[0],
            mpart = m[1];
        var cntryname = window.COUNTRIES[abbr][0];
        var centerof = window.COUNTRIES[abbr][1][mpart][0][0],
            coords = window.COUNTRIES[abbr][1][mpart][1];
        dbcarta.loadCarta([['Area', abbr + mpart, coords, cntryname, centerof]]);
        dbcarta2.loadCarta([['Area', abbr + mpart, coords, cntryname, centerof]]);
        dbcarta3.loadCarta([['Area', abbr + mpart, coords, cntryname, centerof]]);
        dbcarta4.loadCarta([['Area', abbr + mpart, coords, cntryname, centerof]]);
      }
    }
    // draw on centre
    if (centerof) {
      var points = dbcarta.toPoints(centerof, true);
      dbcarta.centerCarta(points[0] + dbcarta.m.offset_x, points[1] + dbcarta.m.offset_y);
      dbcarta2.initProj(' +lon_0=' + centerof[0] + ' +lat_0=' + centerof[1]);
      dbcarta3.initProj(' +lon_0=' + centerof[0] + ' +lat_0=' + centerof[1]);
      dbcarta4.centerCarta(points[0] + dbcarta4.m.offset_x, points[1] + dbcarta4.m.offset_y);
    }
    dbcarta.draw();
    dbcarta2.draw();
    dbcarta3.draw();
    dbcarta4.draw();
  }
  function refresh() {
    window.location.reload(false);
  }
  function init() {
    var mtab = document.createElement("table");
    mtab.width = "100%";
    var tb = document.createElement("tbody");
    mtab.appendChild(tb);
    var row = document.createElement("tr");
    tb.appendChild(row);

    var col = document.createElement("td");
    col.rowSpan = "2";
    col.width = "15%";
    col.style.borderWidth = "1";
    col.style.borderStyle = "solid";
    col.style.verticalAlign = "top";
    var el = document.createElement('div');
    el.appendChild(document.createTextNode("Countries by part:"));    
    col.appendChild(el);
    var cntrylist = el2 = document.createElement("select");
    el2.id = "cntrylist"
    el2.multiple="true";
    el2.size = "20";
    el = document.createElement('div');    
    el.appendChild(el2);
    col.appendChild(el);
    el = document.createElement('div');    
    var el2 = document.createElement('button');
    el2.onclick = draw;
    el2.appendChild(document.createTextNode("show"));
    el.appendChild(el2);
    el2 = document.createElement('button');
    el2.onclick = refresh;
    el2.appendChild(document.createTextNode("refresh"));
    el.appendChild(el2);
    col.appendChild(el);
    row.appendChild(col);

    col = document.createElement("td");
    col.id = "canvasmap";
    col.width = "40%";
    row.appendChild(col);
    col = document.createElement("td");
    col.id = "canvasmap2";
    col.width = "40%";
    row.appendChild(col);
    tb.appendChild(row);
    row = document.createElement("tr");
    col = document.createElement("td");
    col.id = "canvasmap3";
    col.width = "40%";
    row.appendChild(col);
    col = document.createElement("td");
    col.id = "canvasmap4";
    col.width = "40%";
    row.appendChild(col);
    tb.appendChild(row);

    el = document.createElement("h2");
    el.appendChild(document.createTextNode("World's Countries Demo"));
    el.style.margin = "0";
    el.style.backgroundColor = "rgb(230,230,230)";
    document.body.appendChild(el);
    document.body.appendChild(mtab);

    dbcarta = new dbCarta("canvasmap");
    dbcarta.loadCarta(window.CONTINENTS);
    dbcarta.loadCarta(meridians = dbcarta.createMeridians());
    dbcarta.draw();
    dbcarta2 = new dbCarta("canvasmap2");
    dbcarta2.changeProject(203);
    dbcarta2.scaleCarta(3);
    dbcarta2.loadCarta(window.CONTINENTS);
    dbcarta2.loadCarta(meridians);
    dbcarta2.draw();
    dbcarta3 = new dbCarta("canvasmap3");
    dbcarta3.changeProject(201);
    dbcarta3.scaleCarta(2);
    dbcarta3.loadCarta(window.CONTINENTS);
    dbcarta3.loadCarta(meridians);
    dbcarta3.draw();
    dbcarta4 = new dbCarta("canvasmap4");
    dbcarta4.changeProject(101);
    dbcarta4.scaleCarta(3);
    dbcarta4.loadCarta(window.CONTINENTS);
    dbcarta4.loadCarta(meridians);
    window.CONTINENTS = undefined;
    dbcarta4.draw();

    for (var abbr in window.COUNTRIES) {
      el = document.createElement("optgroup");
      el.label = window.COUNTRIES[abbr][0];
      for (var j in window.COUNTRIES[abbr][1]) {
        el2 = document.createElement("option");
        el2.appendChild(document.createTextNode(abbr + "." + j));
        el.appendChild(el2);
      }
      cntrylist.appendChild(el);
    }
  }
</script>
{% endblock %}